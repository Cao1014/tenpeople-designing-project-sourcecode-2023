# ~~STM32~~
~~因项目要求不允许使用Arduino主板，需要进行STM32的移植，目前在CHASSIS_STM.ino的基础上进行移植工作，主要内容是完成兼容层~~

~~目前已完成：数字输出；PWM输出~~

~~正在进行：数字输入~~

~~未开始：UART I/O；中断移植~~

已成功验证Arduino移植到STM32的可行性，目前已经完成了底盘驱动程序的移植工作。

目前STM32改为主控板，连接超声波模块、电机驱动板、机械臂等

# 主控程序
计划在STM32G474平台上进行主控程序的编写，并实现以下目标：

**TODO**
- [x] 超声波模块的驱动
- [x] 与电机驱动板的通信
- [x] 实现超声波对齐
- [x] 移植舵机部分代码
- [ ] 移植通信模块部分代码
- [ ] 综合编程（是否使用RTOS？）
## 超声波模块的驱动
见 [wiki](https://github.com/ray24777/tdps2023/wiki/%E8%B6%85%E5%A3%B0%E6%B3%A2%E6%B5%8B%E8%B7%9D-STM32%E5%AE%9E%E7%8E%B0-%E4%BE%A7%E9%9D%A2%E5%AF%B9%E9%BD%90)，使用了定时器中断读取脉冲宽度的方法，MCU占用较低。
## 与电机驱动板的通信
使用了HAL轮询串口通信，若有需要可改为DMA方式。

## 超声波对齐
移植了[CHASSIS_STM.ino](../Arduino/CHASSIS_STM/CHASSIS_STM.ino)中的部分代码，并改用[HAL兼容的PID库](https://github.com/Majid-Derhambakhsh/PID-Library)，可能需要进一步调参。

### 栏杆尺寸
柱子宽度 15cm

相对与栏杆，柱子突出了3.5cm

栏杆用于超声波对齐部分的高度为9.5cm-14.5cm，需要3D打印零件以使得超声波模块与栏杆平行。

### ATK 十轴飞控（作为陀螺仪）

获取小车角度，精度较高，用于 task 2

上报频率 100 Hz

### 舵机代码

为节省 GPIO 和方便 PCB，此处用的是 35 ms 周期，但亲测没事

注意调用时后两个最好不要动
